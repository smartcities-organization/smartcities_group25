var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){utils._suppressLog=false;var logger=function(){function logger(){var _this=this;this.log=function(msg){if(_this._logger&&_this._logger.log&&!utils._suppressLog){_this._logger.log(msg)}};this.info=function(msg){if(_this._logger&&_this._logger.info&&!utils._suppressLog){_this._logger.info(msg)}};this.warn=function(msg){if(_this._logger&&_this._logger.warn){_this._logger.warn(msg)}};this.error=function(msg){if(_this._logger&&_this._logger.error){_this._logger.error(msg)}};this._logger=window&&window.console?window.console:console?console:{log:function(msg){},info:function(msg){},warn:function(msg){},error:function(msg){}}}logger.log=function(msg){(new logger).log(msg)};logger.info=function(msg){(new logger).info(msg)};logger.warn=function(msg){(new logger).warn(msg)};logger.error=function(msg){(new logger).error(msg)};return logger}();utils.logger=logger})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var Logger=tpco.mkt.utils.logger;var cookies=function(){function cookies(cookie_domain){var _this=this;this.cookie_domain=cookie_domain;this._cookieDomain="";this._cookiesEnabled=true;this._logger=Logger;this.GetCookieValue=function(cookieName){if(!_this._cookiesEnabled){_this._logger.error("Cookies not enabled!");return null}var nameEQ=cookieName+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length)}}return null};this.SetCookieValue=function(name,value,expiry){if(!_this._cookiesEnabled){_this._logger.error("Cookies not enabled!");return}if(expiry){var date=new Date;date.setTime(date.getTime()+expiry*24*60*60*1e3);var expires="; expires="+date.toUTCString()}else{var expires=""}var new_cookie_text=name+"="+value+expires+"; path=/;domain="+_this._cookieDomain;document.cookie=new_cookie_text;_this._logger.info("Cookie created: "+new_cookie_text)};this._cookieDomain=cookie_domain;this._cookiesEnabled=navigator.cookieEnabled;this._logger.info("Cookie lib initialized ("+cookie_domain+")")}cookies.GetCookieVal=function(cookieDomain,cookieName){var c=new cookies(cookieDomain);return c.GetCookieValue(cookieName)};cookies.SetCookieVal=function(cookieDomain,cookieName,cookieVal,expiry){var c=new cookies(cookieDomain);c.SetCookieValue(cookieName,cookieVal,expiry)};return cookies}();utils.cookies=cookies})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var UTMVariable=function(){function UTMVariable(pname,cname,cexp,hubfield,desc){this.utm_param_name=pname;this.cookie_name=cname;this.cookie_expiry_days=cexp;this.hubspot_form_field_name=hubfield;this.description=desc}return UTMVariable}();utils.UTMVariable=UTMVariable})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));String.prototype.format=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i-0]=arguments[_i]}return this.replace(new RegExp("{-?[0-9]+}","g"),function(item){var intVal=parseInt(item.substring(1,item.length-1));var replace;if(intVal>=0){replace=args[intVal]}return replace})};var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var Constants=function(){function Constants(){}Constants.LIB_NAME="tpco.mkt.utils";Constants.VERSION="2.1.31";Constants.THOMASNET_COOKIE_DOMAIN=".thomasnet.com";Constants.HS_NOT_FOUND_MSG="Hubspot is not available.";Constants.JQUERY_NOT_FOUND_MSG="jQuery is not available.";Constants.INIT_MSG="initializing {0}.".format(Constants.LIB_NAME);Constants.CREATE_MSG="Created {0}.".format(Constants.LIB_NAME);Constants.COOKIE_DISABLED_MSG="Cookies are disabled.";Constants.INIT_COMPLETE_MSG="Utils library already initialized.";return Constants}();utils.Constants=Constants})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var core;(function(core){function _shallowCopy(source){var result={};for(var prop in source){result[prop]=source[prop]}return result}core._shallowCopy=_shallowCopy;function _getUrlParam(paramName){var queryString=window.location.search;queryString=queryString.split("+").join(" ");var params={},tokens,re=/[?&]?([^=]+)=([^&]*)/g;while(tokens=re.exec(queryString)){params[decodeURIComponent(tokens[1])]=decodeURIComponent(tokens[2])}return params[paramName]}core._getUrlParam=_getUrlParam;function _getPageDomain(){var parts=window.location.hostname.split(".");while(parts.length>2){var x=parts.shift()}return parts.join(".")}core._getPageDomain=_getPageDomain})(core=utils.core||(utils.core={}))})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var libcore=function(){function libcore(){this._checkJQuery=function(jqref){if(jqref){return true}if(window&&window["jQuery"]){jqref=window["jQuery"];return true}if(typeof $!=="undefined"){jqref=$;return true}return false};this._hasHubspt=function(hubref){if(hubref){return true}else if(typeof hbspt!=="undefined"&&typeof hbspt.forms!=="undefined"&&typeof hbspt.forms.create!=="undefined"){hubref=hbspt;return true}return false}}return libcore}();utils.libcore=libcore})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var tpcohubspot;(function(tpcohubspot){var HS_FORM_CREATING_MSG="Creating hubspot form.";var HS_FORM_CREATED_MSG="Hubspot form creation complete.";var log=tpco.mkt.utils.logger;function CreateHubspotForm(options,hSpotRef){log.info(HS_FORM_CREATING_MSG);log.log(options);var formOptions=tpco.mkt.utils.core._shallowCopy(options);hSpotRef.forms.create(formOptions);log.info(HS_FORM_CREATED_MSG)}tpcohubspot.CreateHubspotForm=CreateHubspotForm;function SetHubspotFormFieldValue(jq,fieldname,fieldval){var isjq=jq?true:false;this._log.info("SetHubspotFormFieldValue fired. jq NOT null: "+isjq+". fieldname: "+fieldname+". fieldval: "+fieldval);var sel=".hs-form-field input[name='{0}']".format(fieldname);this._log.info("selector: "+sel);var fld=jq(sel).val(fieldval);return fld.length>0}tpcohubspot.SetHubspotFormFieldValue=SetHubspotFormFieldValue})(tpcohubspot=utils.tpcohubspot||(utils.tpcohubspot={}))})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var Logger=tpco.mkt.utils.logger;var CONST=tpco.mkt.utils.Constants;var Hubspot=tpco.mkt.utils.tpcohubspot;var lib=function(_super){__extends(lib,_super);function lib(options){var _this=this;_super.call(this);this._initComplete=false;this._initUtmsComplete=false;this._pollInterval=100;this._pollIntervalDecay=2;this._maxFormPollRetries=5;this._formPollCounter=0;this._hsFormValsPushed=false;this._log=Logger;this._getCookie=tpco.mkt.utils.cookies.GetCookieVal;this._setCookie=tpco.mkt.utils.cookies.SetCookieVal;this._getUrlParam=tpco.mkt.utils.core._getUrlParam;this._getPageDomain=tpco.mkt.utils.core._getPageDomain;this._setHsFormFieldVal=Hubspot.SetHubspotFormFieldValue;this.UtmCookiesSet=this._initUtmsComplete;this.HsFormFieldValsPushed=this._hsFormValsPushed;this.Version=CONST.VERSION;this._initUtils=function(config){tpco.mkt.utils._suppressLog=config.suppressLog;if(_this._initComplete===true){_this._log.info(CONST.INIT_COMPLETE_MSG);return}_this._log.info(CONST.INIT_MSG);_this._log.log(config);if(!config||!config.variables||config.variables.length==0){_this._log.error("Unable to initialize tpco.mkt.utils. Lib config is missing or invalid.");return}_this._configOptions=config;if(_this._checkJQuery(_this._configOptions.jQRef)===false){_this._log.info(CONST.JQUERY_NOT_FOUND_MSG)}if(_this._hasHubspt(_this._configOptions.hSpotRef)===false){_this._log.info(CONST.HS_NOT_FOUND_MSG)}else{_this._log.info("Jquery reference found.")}_this._initComplete=true};this._pushUtmCodesToCookies=function(){var self=_this;var configvars=_this._readConfigVars("_pushUtmCodesToCookies");_this._log.info("config vars");_this._log.log(configvars);if(!configvars){return}configvars.forEach(function(item,idx){var paramValue=_this._getUrlParam(item.utm_param_name);if(paramValue!==null&&typeof paramValue!=="undefined"){self._log.info("found url param: "+item.utm_param_name);self._setCookie(CONST.THOMASNET_COOKIE_DOMAIN,item.cookie_name,paramValue,item.cookie_expiry_days)}});_this._initUtmsComplete=true};this._setHsFormPollingTimer=function(){var configvars=_this._readConfigVars("_setHsFormPollingTimer");if(!configvars){return}if(_this._formPollCounter<_this._maxFormPollRetries){_this._log.info("setting hs form poll timer. interval: "+_this._pollInterval.toString());setTimeout(_this._tryPushHubspotFormVals,_this._pollInterval)}else{_this._log.info("form poll timer not set. already passed max retries ["+_this._maxFormPollRetries.toString()+"]")}};this._tryPushHubspotFormVals=function(){_this._log.info("_tryPushHubspotFormVals fired.");if(_this._hsFormValsPushed){_this._log.info("hs form vals already pushed");return}if(!_this._checkJQuery(_this._configOptions.jQRef)){_this._log.info(CONST.JQUERY_NOT_FOUND_MSG);return}var configvars=_this._readConfigVars("_checkForHubspotForm");if(!configvars){return}var cookielist=[];configvars.forEach(function(item){_this._log.info("looking for cookie val: "+item.cookie_name);var paramValue=_this._getCookie(CONST.THOMASNET_COOKIE_DOMAIN,item.cookie_name);_this._log.info("value: "+paramValue);if(paramValue!==null&&typeof paramValue!=="undefined"){var cookieitem={cookiename:item.cookie_name,cookieval:paramValue,hsfield:item.hubspot_form_field_name};cookielist.push(cookieitem)}});if(cookielist&&cookielist.length>0){cookielist.forEach(function(item,idx){if(_this._setHsFormFieldVal(_this._configOptions.jQRef,item.hsfield,item.cookieval)){_this._hsFormValsPushed=true}});_this._formPollCounter++;_this._pollInterval=_this._pollInterval*_this._pollIntervalDecay;_this._setHsFormPollingTimer()}else{_this._log.info("no cookielist to set HS fields")}};this._readConfigVars=function(src){var configvars=_this._configOptions.variables;if(!configvars){_this._log.error(src+": No utm variables found in tpco.mkt.utils config.");return null}return configvars};this._log.info(CONST.CREATE_MSG);CONST.THOMASNET_COOKIE_DOMAIN=this._getPageDomain();this._initUtils(options);this._pushUtmCodesToCookies();this._setHsFormPollingTimer()}return lib}(utils.libcore);utils.lib=lib})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));var tpco;(function(tpco){var mkt;(function(mkt){var utils;(function(utils){var configOpts=function(){function configOpts(jq,utmparams){this.utmPublishId="3";this.suppressLog=true;this.jQRef=jq;this.variables=utmparams}return configOpts}();utils.configOpts=configOpts;utils._tpcojq=$||jQuery||null;utils._utmoptions=new configOpts(utils._tpcojq,JSON.parse('[{"utm_param_name":"SourceEmail","cookie_name":"SourceEmail","cookie_expiry_days":"30","hubspot_form_field_name":"SourceEmail","description":"SourceEmail","utmid":"2015-12-01T18:49:04.450Z"},{"utm_param_name":"SourceOutsideAd","cookie_name":"SourceOutsideAd","cookie_expiry_days":"30","hubspot_form_field_name":"SourceOutsideAd","description":"SourceOutsideAd","utmid":"2015-12-01T18:50:02.559Z"},{"utm_param_name":"SourceHouseAd","cookie_name":"SourceHouseAd","hubspot_form_field_name":"SourceHouseAd","description":"SourceHouseAd","cookie_expiry_days":"30","utmid":"2015-12-01T18:50:40.035Z"},{"utm_param_name":"SourceExternalLink","cookie_name":"SourceExternalLink","hubspot_form_field_name":"SourceExternalLink","description":"SourceExternalLink","cookie_expiry_days":"30","utmid":"2015-12-01T18:50:59.324Z"},{"utm_param_name":"SourceInternalLink","cookie_expiry_days":"30","cookie_name":"SourceInternalLink","hubspot_form_field_name":"SourceInternalLink","description":"SourceInternalLink","utmid":"2015-12-01T18:51:27.956Z"},{"utm_param_name":"SourceOther","cookie_name":"SourceOther","hubspot_form_field_name":"SourceOther","description":"SourceOther","cookie_expiry_days":"30","utmid":"2015-12-01T18:51:54.538Z"},{"utm_param_name":"SourceAssign","cookie_name":"SourceAssign","hubspot_form_field_name":"SourceAssign","description":"SourceAssign","cookie_expiry_days":"30","utmid":"2015-12-01T18:52:20.419Z"},{"utm_param_name":"utm_source","cookie_name":"utm_source","hubspot_form_field_name":"utm_source","cookie_expiry_days":"30","description":"utm_source","utmid":"2015-12-01T18:52:57.501Z"},{"utm_param_name":"utm_medium","cookie_expiry_days":"30","cookie_name":"utm_medium","hubspot_form_field_name":"utm_medium","description":"utm_medium","utmid":"2015-12-01T18:53:21.916Z"},{"utm_param_name":"utm_term","cookie_expiry_days":"utm_term","hubspot_form_field_name":"utm_term","description":"utm_term","cookie_name":"30","utmid":"2015-12-01T18:53:42.733Z"},{"utm_param_name":"utm_content","cookie_name":"utm_content","hubspot_form_field_name":"utm_content","description":"utm_content","cookie_expiry_days":"30","utmid":"2015-12-01T18:54:07.103Z"},{"utm_param_name":"utm_campaign","cookie_name":"utm_campaign","hubspot_form_field_name":"utm_campaign","description":"utm_campaign","cookie_expiry_days":"30","utmid":"2015-12-01T18:56:02.352Z"}]'));utils._instance=new utils.lib(utils._utmoptions)})(utils=mkt.utils||(mkt.utils={}))})(mkt=tpco.mkt||(tpco.mkt={}))})(tpco||(tpco={}));